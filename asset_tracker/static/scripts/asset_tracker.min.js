"use strict";function manageSites(){$("#site__reference").clone().prop("id","site_id").prop("name","site_id").appendTo("#site__options");const e=$("#tenant_id").find("option:selected").val();$("#site_id").children("option").each((function(){$(this).data("tenant_id")&&$(this).data("tenant_id")!==e&&$(this).remove()}))}function setActiveMenu(e){e.removeClass("active");const t=window.location.pathname.split("/",2).join("/");e.find(`a[href="${t}/"]`).parent("li").addClass("active")}$(document).on("change","#tenant_id",(function(){let e=$("#site_id");e.select2("destroy"),e.remove(),manageSites(),e=$("#site_id"),e.val(""),e.select2({theme:"bootstrap",width:"100%"})})),$(document).on("click",".equipment__add",(function(e){e.stopPropagation();const t=$(this).closest(".panel.panel-default");t.removeClass("no-equipment"),t.find(".collapse").collapse("show");const n=$("#equipments__reference").clone();let a=0;$(".equipment__block").each((function(){$(this).data("equipmentsCounter")>a&&(a=$(this).data("equipmentsCounter"))})),a+=1;const o=n.find(".equipment__family"),i=o.eq(0).attr("id"),s=`${a}#${i}`;$(`label[for="${i}"]`).attr("for",s),o.attr("id",s).attr("name",s);const c=n.find(".equipment__serial_number"),r=c.eq(0).attr("id"),l=`${a}#${r}`;$(`label[for="${r}"]`).attr("for",l),c.attr("id",l).attr("name",l),n.data("equipmentsCounter",a).removeAttr("id").removeClass("hidden").appendTo("#equipments__list"),n.find("select").select2({theme:"bootstrap",width:"100%"})})),$(document).on("click",".equipment__remove",(function(){2===$(".equipment__block").length&&(console.log($(this).closest(".panel.panel-default")),$(this).closest(".panel.panel-default").addClass("no-equipment")),$(this).closest(".equipment__block").remove()})),$(document).on("change",".equipment__family",(function(e){const t=$(this).closest(".equipment__block"),n=t.find(".expiration_dates"),a=t.data("equipmentsCounter"),o=e.target.value;n.empty();const i=$("#equipments__container").data("consumablesFamilies");if(i[o]){const e=Object.entries(i[o]);e.sort(((e,t)=>e[1].localeCompare(t[1]))),e.forEach((function(e){const t=$("#equipments_consumables__reference").clone().removeAttr("id").removeClass("hidden"),o=`${a}#${e[0]}-expiration_date`,i=t.find("label");i.attr("for",o),i.text(e[1]);t.find("input").attr("id",o).attr("name",o),n.append(t)}))}}));const DATATABLES_TRANSLATIONS={fr:{sProcessing:"Traitement en cours...",sSearch:"Rechercher&nbsp;:",sLengthMenu:"Afficher _MENU_ &eacute;l&eacute;ments",sInfo:"Affichage de l'&eacute;l&eacute;ment _START_ &agrave; _END_ sur _TOTAL_ &eacute;l&eacute;ments",sInfoEmpty:"Affichage de l'&eacute;l&eacute;ment 0 &agrave; 0 sur 0 &eacute;l&eacute;ments",sInfoFiltered:"(filtr&eacute; de _MAX_ &eacute;l&eacute;ments au total)",sInfoPostFix:"",sLoadingRecords:"Chargement en cours...",sZeroRecords:"Aucun &eacute;l&eacute;ment &agrave; afficher",sEmptyTable:"Aucune donn&eacute;e disponible dans le tableau",oPaginate:{sFirst:"Premier",sPrevious:"Pr&eacute;c&eacute;dent",sNext:"Suivant",sLast:"Dernier",sSeparator:"sur"},oAria:{sSortAscending:": activer pour trier la colonne par ordre croissant",sSortDescending:": activer pour trier la colonne par ordre d&eacute;croissant"}}};function addHrefToDataTablesRows(e,t){if(t.links){const n=jQuery.grep(t.links,(function(e){return"self"===e.rel}));$(e).find("td").each((function(){$(this).html()||$(this).html("&nbsp;"),$(this).wrapInner(`<a href="${n[0].href}"></a>`)}))}}function cancelColReorderEvents(){$(document).unbind("touchmove.ColReorder"),$(document).unbind("mousemove.ColReorder"),$(document).unbind("mouseup.ColReorder"),$(document).unbind("touchend.ColReorder")}function manageColumnsRender(e){const t=[];return e.find("th").each((function(){const e={},n=$(this).data("render");n&&(e.render=window[n]),t.push(e)})),t}function styleInactiveObjects(e,t){Object.prototype.hasOwnProperty.call(t,"is_active")&&!t.is_active&&$(e).addClass("warning")}function assetTrackerCallback(e,t){addHrefToDataTablesRows(e,t),styleInactiveObjects(e,t)}$((function(){const e=$("table.dataTables");if(!e)return;const t={serverSide:!0,ajax:{url:e.data("ajax-url")},stateSave:!0,pageLength:50,lengthChange:!1,responsive:{details:!1},processing:!0,columns:manageColumnsRender(e),rowCallback:assetTrackerCallback,colReorder:!0,colResize:{isEnabled:!0,isResizable:function(e){return!!e.sTitle},onResizeStart:cancelColReorderEvents,onResize:cancelColReorderEvents}};window.userLocale in DATATABLES_TRANSLATIONS&&(t.language=DATATABLES_TRANSLATIONS[window.userLocale]);const n=e.data("custom-filter");n&&(t.dom='<"row"<"col-sm-6"<"custom_filter checkbox">><"col-sm-6"f>><"row"<"col-sm-12"tr>><"row"<"col-sm-5"i><"col-sm-7"p>>');const a=e.DataTable(t);if(n){const t=$(a.table().container());t.find(".dataTables_info").css("padding-bottom","10px"),a.on("stateSaveParams.dt",(function(e,n,a){a.customFilter=!t.find(".custom_filter__input").is(":checked")}));const n=e.data("custom-filter-label"),o=a.state.loaded(),i=`<label><input class="custom_filter__input" type="checkbox"${o&&o.customFilter?"":" checked"}> ${n}</label>`;t.find(".custom_filter").html(i).css("padding","10px 0 0 10px"),a.state.save(),t.find(".custom_filter__input").on("change",a.draw)}e.on("preXhr.dt",a.state.save)})),$(document).on("preInit.dt",(function(e,t){const n=new $.fn.dataTable.Api(t).state.loaded(),a=$(e.target),o=a.data("custom-filter");o&&(t.ajax.data=function(e){const t=$(a.DataTable().table().container()).find(".custom_filter__input");(t.length&&!t.is(":checked")||!t.length&&n&&n.customFilter)&&(e.filter=o)})})),$(document).on("click",".event__delete",(function(){const e=$(this).data("eventid");$("form").append(`<input type="hidden" name="event-removed" value="${e}">`),$(this).parent().hide("fast")})),$(document).on("click",".panel_link",(function(e){e.stopPropagation(),window.location=$(this).prop("href")})),$((function(){setActiveMenu($("#menu-main li, #menu-settings li"));const e=$("input[type=text]").first();e.trigger("focus"),e.val(e.val()),manageSites(),$("select:visible").select2({theme:"bootstrap",width:"100%"})}));