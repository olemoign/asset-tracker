"use strict";var GLUCOMETER_FAMILY_ID="2YUEMLmH";function manageSites(){$("#site__reference").clone().prop("id","site_id").prop("name","site_id").addClass("custom_select2").show().appendTo("#site__options");var e=$("#tenant_id").find("option:selected").val();$("#site_id").children("option").each(function(){$(this).data("tenant_id")&&$(this).data("tenant_id")!==e&&$(this).remove()})}function setActiveMenu(e){e.removeClass("active");var t=window.location.pathname.split("/",2).join("/");e.find('a[href="'+t+'/"]').parents("li").addClass("active")}$(document).on("change","#tenant_id",function(){var e=$(".custom_select2");e.select2("destroy"),e.remove(),manageSites(),(e=$(".custom_select2")).val(""),e.select2({theme:"bootstrap",width:"100%"})}),$(document).on("click",".equipment__add",function(){$("#equipment__reference").clone().removeAttr("id").show().appendTo("#equipments__list")}),$(document).on("click",".equipment__remove",function(){$(this).parents(".equipment__block").remove()}),$(document).on("change",".equipment__select",function(){var e=$(this).parents(".equipment__block").find(".expiration_date_fields");$(this).val()===GLUCOMETER_FAMILY_ID?e.show():(e.hide(),e.find("input").val(""))});var dataTablesTranslations={fr:{sProcessing:"Traitement en cours...",sSearch:"Rechercher&nbsp;:",sLengthMenu:"Afficher _MENU_ &eacute;l&eacute;ments",sInfo:"Affichage de l'&eacute;l&eacute;ment _START_ &agrave; _END_ sur _TOTAL_ &eacute;l&eacute;ments",sInfoEmpty:"Affichage de l'&eacute;l&eacute;ment 0 &agrave; 0 sur 0 &eacute;l&eacute;ments",sInfoFiltered:"(filtr&eacute; de _MAX_ &eacute;l&eacute;ments au total)",sInfoPostFix:"",sLoadingRecords:"Chargement en cours...",sZeroRecords:"Aucun &eacute;l&eacute;ment &agrave; afficher",sEmptyTable:"Aucune donn&eacute;e disponible dans le tableau",oPaginate:{sFirst:"Premier",sPrevious:"Pr&eacute;c&eacute;dent",sNext:"Suivant",sLast:"Dernier"},oAria:{sSortAscending:": activer pour trier la colonne par ordre croissant",sSortDescending:": activer pour trier la colonne par ordre d&eacute;croissant"}}};function addHref(e,t){if(t.links){var a=$.grep(t.links,function(e){return"self"===e.rel});$(e).find("td").each(function(){$(this).html()||$(this).html("&nbsp;"),$(this).wrapInner('<a href="'+a[0].href+'"></a>')})}}function styleInactiveObjects(e,t){Object.prototype.hasOwnProperty.call(t,"is_active")&&!t.is_active&&$(e).addClass("warning")}function assetTrackerCallback(e,t){addHref(e,t),styleInactiveObjects(e,t)}function createDataTables(){var e=$("table.dataTables");if(e){var t=[],a=e.data("custom-filter");e.find("th").each(function(){var e={},a=$(this).data("render");a&&(e.render=window[a]),t.push(e)});var n={serverSide:!0,ajax:{url:e.data("ajax-url")},stateSave:!0,pageLength:50,lengthChange:!1,responsive:{details:!1},processing:!0,columns:t,columnDefs:[{targets:"_all",render:$.fn.dataTable.render.text()}],rowCallback:assetTrackerCallback};"en"!==userLocale&&(n.language=dataTablesTranslations[userLocale]),a&&(n.dom='<"row"<"col-sm-6"<"custom_filter checkbox">><"col-sm-6"f>><"row"<"col-sm-12"tr>><"row"<"col-sm-5"i><"col-sm-7"p>>');var i=e.DataTable(n);if(a){var s=$(i.table().container());i.on("stateSaveParams.dt",function(e,t,a){a.customFilter=!s.find(".custom_filter__input").is(":checked")});var r=e.data("custom-filter-label"),c=i.state.loaded(),o=!0===e.data("custom-filter-default"),l='<label><input class="custom_filter__input" type="checkbox"'+(!c&&!o||c&&!c.customFilter?" checked":"")+"> "+r+"</label>";s.find(".custom_filter").html(l),i.state.save(),s.find(".custom_filter__input").on("change",i.draw)}e.on("preXhr.dt",i.state.save)}}function restoreDates(){Modernizr.inputtypes.date||$('input[type="date"]').each(function(){if(this.value){var e=this.value.match(/^(\d{4})-(\d{2})-(\d{2})$/);e&&(this.value=e[3]+"/"+e[2]+"/"+e[1])}})}$(document).on("preInit.dt",function(e,t){var a=new $.fn.dataTable.Api(t).state.loaded(),n=$(e.target),i=n.data("custom-filter");i&&(t.ajax.data=function(e){var t=$(n.DataTable().table().container()).find(".custom_filter__input"),s=!0===n.data("custom-filter-default");(t.length&&!t.is(":checked")||!t.length&&a&&a.customFilter||!t.length&&!a&&s)&&(e.filter=i)})}),$(document).on("click",".paginate_button",function(){$("body").animate({scrollTop:0},"slow")}),$(document).on("click",".event__delete",function(){var e=$(this).data("eventid");$("form").append('<input type="hidden" name="event-removed" value="'+e+'">'),$(this).parent().hide("fast")}),$(document).on("submit","form",function(e){$(this).find('input[type="date"]').each(function(){if(this.value){var e=/^(\d{2})\/(\d{2})\/(\d{4})$/;if(e.test(this.value))return this.value=this.value.replace(e,"$3-$2-$1"),void this.setCustomValidity("");/^\d{4}-\d{2}-\d{2}$/.test(this.value)?this.setCustomValidity(""):this.setCustomValidity("Invalid date.")}else this.setCustomValidity("")}),this.reportValidity()||e.preventDefault()}),$(document).on("input",'input[type="date"]',function(){this.setCustomValidity("")}),$(function(){setActiveMenu($("#menu-main li, #menu-settings li")),createDataTables();var e=$("input[type=text]").first();e.trigger("focus"),e.val(e.val()),restoreDates(),manageSites(),$(".custom_select2").select2({theme:"bootstrap",width:"100%"})});